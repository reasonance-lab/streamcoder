import streamlit as st
import requests
from bs4 import BeautifulSoup
import pandas as pd

def search_fda_database(drug_name):
    url = f"https://api.fda.gov/drug/label.json?search=openfda.brand_name:{drug_name}&limit=1"
    response = requests.get(url)
    return response.json()

def extract_drug_info(data):
    drug_info = {}
    if 'results' in data and len(data['results']) > 0:
        result = data['results'][0]
        for key, value in result.items():
            if isinstance(value, list) and len(value) > 0:
                drug_info[key] = value[0]
            elif isinstance(value, str):
                drug_info[key] = value
    return drug_info

def format_drug_info(drug_info):
    formatted_info = {}
    for key, value in drug_info.items():
        if isinstance(value, str):
            soup = BeautifulSoup(value, 'html.parser')
            formatted_info[key.replace('_', ' ').title()] = soup.get_text()
        else:
            formatted_info[key.replace('_', ' ').title()] = value
    return formatted_info

st.set_page_config(layout="wide")

st.title("FDA Drug Information Search")

drug_name = st.text_input("Enter a drug name:")

if drug_name:
    data = search_fda_database(drug_name)
    drug_info = extract_drug_info(data)
    
    if drug_info:
        st.subheader(f"Information for {drug_name}")
        formatted_info = format_drug_info(drug_info)
        
        col1, col2 = st.columns(2)
        
        for i, (key, value) in enumerate(formatted_info.items()):
            if i % 2 == 0:
                with col1:
                    st.markdown(f"**{key}:**")
                    st.write(value)
                    st.markdown("---")
            else:
                with col2:
                    st.markdown(f"**{key}:**")
                    st.write(value)
                    st.markdown("---")
    else:
        st.warning("No information found for the given drug name.")

st.sidebar.markdown("### About")
st.sidebar.info("This app searches the FDA's public API for drug information based on the user's input.")