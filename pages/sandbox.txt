import streamlit as st
import py3Dmol
from rdkit import Chem
from rdkit.Chem import AllChem

def generate_3d_structure(smiles):
    mol = Chem.MolFromSmiles(smiles)
    mol = Chem.AddHs(mol)
    AllChem.EmbedMolecule(mol, randomSeed=42)
    AllChem.MMFFOptimizeMolecule(mol)
    return mol

def display_3d_structure(mol):
    viewer = py3Dmol.view(width=600, height=400)
    mol_block = Chem.MolToMolBlock(mol)
    viewer.addModel(mol_block, "mol")
    viewer.setStyle({'stick': {}})
    viewer.zoomTo()
    viewer.render()
    return viewer

st.title("3D Chemical Compound Viewer")

smiles_input = st.text_input("Enter SMILES notation of the compound:")

if smiles_input:
    try:
        mol = generate_3d_structure(smiles_input)
        viewer = display_3d_structure(mol)
        st.write(viewer._repr_html_(), unsafe_allow_html=True)
    except Exception as e:
        st.error(f"Error: {str(e)}")
        st.error("Please enter a valid SMILES notation.")

st.markdown("""
### Instructions:
1. Enter the SMILES notation of a chemical compound in the text box above.
2. The 3D structure of the compound will be displayed.
3. You can rotate, zoom, and pan the 3D model using your mouse.
""")

# Example SMILES notations for users to try
st.sidebar.header("Example SMILES")
st.sidebar.markdown("""
- Water: O
- Ethanol: CCO
- Aspirin: CC(=O)OC1=CC=CC=C1C(=O)O
- Caffeine: CN1C=NC2=C1C(=O)N(C(=O)N2C)C
""")