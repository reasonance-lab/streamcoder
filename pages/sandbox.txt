import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from datetime import datetime, timedelta
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from sklearn.linear_model import LinearRegression

# Generate fictitious stock prices
start_date = datetime(2023, 1, 1)
dates = [start_date + timedelta(days=i) for i in range(90)]

np.random.seed(42)
microsoft_prices = np.random.normal(loc=250, scale=10, size=90).cumsum() + 250
apple_prices = np.random.normal(loc=150, scale=5, size=90).cumsum() + 150

# Create DataFrame
df = pd.DataFrame({
    'Date': dates,
    'Microsoft': microsoft_prices,
    'Apple': apple_prices
})

# Plot 1: Line plot using Matplotlib
plt.figure(figsize=(12, 6))
plt.plot(df['Date'], df['Microsoft'], label='Microsoft')
plt.plot(df['Date'], df['Apple'], label='Apple')
plt.title('Stock Prices: Microsoft vs Apple')
plt.xlabel('Date')
plt.ylabel('Price')
plt.legend()
plt.show()

# Plot 2: Candlestick chart using Plotly
fig = make_subplots(rows=1, cols=2, shared_xaxes=True, subplot_titles=('Microsoft', 'Apple'))

for i, company in enumerate(['Microsoft', 'Apple'], 1):
    fig.add_trace(go.Candlestick(
        x=df['Date'],
        open=df[company],
        high=df[company] + np.random.uniform(0, 5, 90),
        low=df[company] - np.random.uniform(0, 5, 90),
        close=df[company],
        name=company
    ), row=1, col=i)

fig.update_layout(title_text='Stock Prices: Candlestick Chart', height=600)
fig.show()

# Plot 3: Area chart using Plotly
fig = go.Figure()
fig.add_trace(go.Scatter(x=df['Date'], y=df['Microsoft'], fill='tozeroy', name='Microsoft'))
fig.add_trace(go.Scatter(x=df['Date'], y=df['Apple'], fill='tozeroy', name='Apple'))
fig.update_layout(title='Stock Prices: Area Chart', xaxis_title='Date', yaxis_title='Price')
fig.show()

# Predict prices for the next 3 months
future_dates = [start_date + timedelta(days=i) for i in range(90, 180)]

def predict_prices(data):
    X = np.arange(len(data)).reshape(-1, 1)
    y = data.values.reshape(-1, 1)
    model = LinearRegression()
    model.fit(X, y)
    future_X = np.arange(len(data), len(data) + 90).reshape(-1, 1)
    return model.predict(future_X).flatten()

microsoft_pred = predict_prices(df['Microsoft'])
apple_pred = predict_prices(df['Apple'])

# Create DataFrame with predicted prices
future_df = pd.DataFrame({
    'Date': future_dates,
    'Microsoft': microsoft_pred,
    'Apple': apple_pred
})

# Combine historical and predicted data
combined_df = pd.concat([df, future_df])

# Plot historical and predicted prices
fig = go.Figure()

fig.add_trace(go.Scatter(x=combined_df['Date'][:90], y=combined_df['Microsoft'][:90], name='Microsoft (Historical)', line=dict(color='blue')))
fig.add_trace(go.Scatter(x=combined_df['Date'][90:], y=combined_df['Microsoft'][90:], name='Microsoft (Predicted)', line=dict(color='blue', dash='dash')))

fig.add_trace(go.Scatter(x=combined_df['Date'][:90], y=combined_df['Apple'][:90], name='Apple (Historical)', line=dict(color='red')))
fig.add_trace(go.Scatter(x=combined_df['Date'][90:], y=combined_df['Apple'][90:], name='Apple (Predicted)', line=dict(color='red', dash='dash')))

fig.update_layout(title='Stock Prices: Historical and Predicted', xaxis_title='Date', yaxis_title='Price')
fig.show()